name: Release

on:
  push:
    tags:
      - 'v*.*.*'

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Compile TypeScript
      run: npm run compile

    - name: Package extension
      run: npm run package

    - name: Get version from tag
      id: get_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: claude-studio-${{ steps.get_version.outputs.VERSION }}.vsix
        body: |
          ## ðŸŽ‰ What's New in v${{ steps.get_version.outputs.VERSION }}

          ### Major Features
          - âœ… **Claude Pro/Max Subscription Support** - Use your existing subscription (no API costs!)
          - âœ… **Dual Authentication** - Choose between subscription or API key
          - âœ… **OAuth Login Flow** - Simple `claude login` command
          - âœ… **Cost Savings** - Pro/Max users pay $0 additional
          - âœ… **Higher Limits** - 5-20x more usage than API key mode

          ### What's Included
          - Comprehensive Getting Started guide with 6 vignettes
          - Example datasets (clinical, genomics, surveys, metadata)
          - R and Python analysis scripts
          - Complete documentation

          See [CHANGELOG.md](https://github.com/shandley/claude-studio/blob/main/CHANGELOG.md) for detailed changes.

          ---

          ## ðŸ“¥ Installation

          1. Download the `.vsix` file below
          2. Open VS Code or Positron
          3. Press `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux)
          4. Type "Install from VSIX"
          5. Select the downloaded `.vsix` file
          6. Restart the IDE

          ## ðŸ“‹ Requirements

          - **VS Code/Positron** 1.41.0+
          - **Claude Code CLI**: `npm install -g @anthropic-ai/claude-code`
          - **Authentication**: Claude Pro/Max subscription OR Anthropic API key

          ## ðŸš€ Quick Start

          After installation:
          1. `Cmd+Shift+P` â†’ "Claude Studio: Configure Authentication"
          2. Choose your authentication method
          3. Follow the setup prompts
          4. Start using Claude Studio!

          ## ðŸ“– Documentation

          - [README](https://github.com/shandley/claude-studio#readme)
          - [Getting Started Guide](https://github.com/shandley/claude-studio/blob/main/GETTING_STARTED.md) - **6 complete vignettes with examples**
          - [Share with Colleagues](https://github.com/shandley/claude-studio/blob/main/SHARE_WITH_COLLEAGUES.md) - Quick testing guide
          - [Contributing](https://github.com/shandley/claude-studio/blob/main/CONTRIBUTING.md)

          ---

          **Made for data scientists, by data scientists** ðŸ§¬ðŸ“ŠðŸ”¬
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
